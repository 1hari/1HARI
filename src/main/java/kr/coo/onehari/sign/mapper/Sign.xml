<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
작성자: 김정하
시작: 2020. 1. 13
완료: 
내용: 문서기안 작업 시작
-->
<mapper namespace="kr.coo.onehari.sign.dao.SignDao">

	<!-- 문서기안 등록하기 김정하 / 2020. 1. 13-->
	<insert id="insertSign">
		INSERT INTO sign (DRAFTEMP, EMPSIGN1, EMPSIGN2, SIGNFORMCODE, SIGNTITLE, SIGNCONTENT, SIGNFILENAME, SIGNFILEROOT)
		VALUES (
			#{draftEmp}, <!-- 기안자 -->
			#{empSign1}, <!-- 결재자1 -->
			#{empSign2}, <!-- 결재자1 -->
			#{signFormCode}, <!-- 문서양식 코드 -->
			#{signTitle}, <!-- 결재자1 -->
			#{signContent}, <!-- 결재내용 -->
			#{signFileName}, <!-- 첨부파일명 -->
			#{signFileRoot} <!-- 첨부파일경로 -->
		)
	</insert>
	
	<!-- 전자결재 기안 리스트 (전자결재 홈) 김정하 / 2020. 1. 13 -->
	<select id="selectSignDraftListHome" resultType="kr.coo.onehari.sign.dto.SignDto">
		SELECT s.SIGNNUM, s.SIGNDATE, f.SIGNFORMFORMNAME, s.SIGNTITLE, t.SIGNNAME, s.SIGNCODE, s.DRAFTEMP, e.EMPNAME as draftEmpName
		FROM sign s JOIN signform f 
						ON s.SIGNFORMCODE = f.SIGNFORMCODE
					JOIN signtype t
						ON s.SIGNCODE = t.SIGNCODE
					JOIN emp e
						ON s.DRAFTEMP = e.EMPNUM
		WHERE s.SIGNCODE IN(1,2) AND s.DRAFTEMP = #{draftEmp}
		ORDER BY s.SIGNDATE DESC
		LIMIT 3
	</select>
	
	<!-- 전자결재 완료 리스트 (전자결재 홈) 김정하 / 2020. 1. 13 -->
	<select id="selectSignCompleteListHome" resultType="kr.coo.onehari.sign.dto.SignDto">
		SELECT s.SIGNNUM, s.SIGNDATE, f.SIGNFORMFORMNAME, s.SIGNTITLE, t.SIGNNAME, s.SIGNCODE, s.DRAFTEMP, e.EMPNAME as draftEmpName
		FROM sign s JOIN signform f 
						ON s.SIGNFORMCODE = f.SIGNFORMCODE
					JOIN signtype t
						ON s.SIGNCODE = t.SIGNCODE
					JOIN emp e
						ON s.DRAFTEMP = e.EMPNUM
		WHERE s.SIGNCODE = 3 AND s.DRAFTEMP = #{draftEmp}
		ORDER BY s.SIGNDATE DESC
		LIMIT 3
	</select>
	
	<!-- 전자결재 반려 리스트 (전자결재 홈) 김정하 / 2020. 1. 13 -->
	<select id="selectSignReturnListHome" resultType="kr.coo.onehari.sign.dto.SignDto">
		SELECT s.SIGNNUM, s.SIGNDATE, f.SIGNFORMFORMNAME, s.SIGNTITLE, t.SIGNNAME, s.SIGNCODE, s.DRAFTEMP, e.EMPNAME as draftEmpName
		FROM sign s JOIN signform f 
						ON s.SIGNFORMCODE = f.SIGNFORMCODE
					JOIN signtype t
						ON s.SIGNCODE = t.SIGNCODE
					JOIN emp e
						ON s.DRAFTEMP = e.EMPNUM
		WHERE s.SIGNCODE = 4 AND s.DRAFTEMP = #{draftEmp}
		ORDER BY s.SIGNDATE DESC
		LIMIT 3
	</select>
	
	<!-- 전자결재 결재대기 리스트 (전자결재 홈) 김정하 / 2020. 1 13 -->
	<select id="selectSignWaitingListHome" resultType="kr.coo.onehari.sign.dto.SignDto">
		SELECT s.SIGNNUM, s.SIGNDATE, f.SIGNFORMFORMNAME, s.SIGNTITLE, t.SIGNNAME, s.SIGNCODE, s.DRAFTEMP, e.EMPNAME as draftEmpName
		FROM sign s JOIN signform f 
						ON s.SIGNFORMCODE = f.SIGNFORMCODE
					JOIN signtype t
						ON s.SIGNCODE = t.SIGNCODE
					JOIN emp e
						ON s.DRAFTEMP = e.EMPNUM
		WHERE s.SIGNCODE IN(1,2) AND if(s.ISSIGN1 = 0, s.EMPSIGN1 = #{draftEmp}, s.EMPSIGN2 = #{draftEmp})
		ORDER BY s.SIGNDATE DESC
		LIMIT 3
	</select>
</mapper>