<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="kr.coo.onehari.hr.dao.EmpDao">
	<!-- 사원등록 (입퇴사관리 메뉴) 김진호 2020. 1. 10 -->
	<insert id="empJoin" parameterType="kr.coo.onehari.hr.dto.EmpDto">
		INSERT INTO emp(teamcode, rankcode, positioncode, employmentcode, empname, PASSWORD)
		VALUES(#{teamcode}, #{rankcode}, #{positioncode}, #{employmentcode}, #{empname}, #{PASSWORD});
	</insert>
	<insert id="subempJoin" parameterType="kr.coo.onehari.hr.dto.EmpDto">
		INSERT INTO subemp(empnum, birth, resnum, phonenum, email, hiredate)
		VALUES(LAST_INSERT_ID(), #{birth}, #{resnum}, #{phonenum}, #{email}, #{hiredate});
	</insert>
	
	<!-- 조직도에서 부서별 사원을 출력해주기 위해 김정하 / 2020. 1. 9 -->
	<select id="empDefaultList" resultType="kr.coo.onehari.hr.dto.EmpDto">
		select EMPNUM, TEAMCODE, EMPNAME from emp
	</select>

	<select id="empList" resultType="kr.coo.onehari.hr.dto.EmpDto">
		SELECT E.EMPNUM, E.EMPNAME, T.TEAMNAME, R.RANKNAME, P.POSITIONNAME, EM.EMPLOYMENTNAME, S.BIRTH, S.PHONENUM, S.EMAIL, S.HIREDATE
		FROM emp AS E 
		JOIN subemp AS S ON E.EMPNUM = S.EMPNUM
		JOIN team AS T ON E.TEAMCODE = T.TEAMCODE
		JOIN ranks AS R ON E.RANKCODE = R.RANKCODE
		JOIN position AS P ON E.POSITIONCODE = P.POSITIONCODE
		JOIN employment AS EM ON E.EMPLOYMENTCODE = EM.EMPLOYMENTCODE
	</select>
   
	<select id="empModify" resultType="kr.coo.onehari.hr.dto.EmpDto">
		SELECT E.EMPNUM, E.TEAMCODE, E.EMPNAME, T.TEAMNAME, R.RANKNAME, P.POSITIONNAME, EM.EMPLOYMENTNAME, S.BIRTH, S.PHONENUM, S.EMAIL, S.HIREDATE
		FROM emp AS E 
		JOIN subemp AS S ON E.EMPNUM = S.EMPNUM
		JOIN team AS T ON E.TEAMCODE = T.TEAMCODE
		JOIN ranks AS R ON E.RANKCODE = R.RANKCODE
		JOIN position AS P ON E.POSITIONCODE = P.POSITIONCODE
		JOIN employment AS EM ON E.EMPLOYMENTCODE = EM.EMPLOYMENTCODE
		WHERE E.EMPNUM=#{empNum}
   </select>
   
  	<update id="empUpdate" parameterType="kr.coo.onehari.hr.dto.EmpDto">
		UPDATE EMP 
		SET TEAMCODE=${teamCode}, 
		POSITIONCODE=${positionCode} ,  
		RANKCODE=${rankCode},
		EMPLOYMENTCODE=${employmentCode}, 
		PHONENUM=#{phoneNum}}
		WHERE EMPNUM=${empNum} 
	</update>
   
</mapper>